<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Entrevista de Salida - Sun Berries</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        sun: {
                            green: '#006400', // Verde oscuro del logo (aprox)
                            light: '#e6f4e6',
                            gold: '#fccb06',  // Amarillo del sol
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 min-h-screen py-8 px-4 font-sans">

    <div class="max-w-3xl mx-auto bg-white rounded-2xl shadow-xl overflow-hidden border-t-8 border-sun-green">
        
        <div class="pt-8 pb-6 text-center bg-sun-light bg-opacity-30">
            <img src="logo.png" alt="Sun Berries Logo" class="h-32 mx-auto mb-4 drop-shadow-md hover:scale-105 transition-transform duration-300">
            <h1 class="text-3xl font-extrabold text-sun-green tracking-tight">Entrevista de Salida</h1>
            <p class="text-gray-500 mt-2 font-medium">Agradecemos tu tiempo y honestidad</p>
        </div>

        <form id="exitForm" class="p-8 space-y-6">
            
            <div>
                <label class="block font-bold text-gray-700 mb-1">Nombre completo *</label>
                <input type="text" name="nombre_completo" required class="w-full rounded-lg border-gray-300 shadow-sm p-3 border-2 focus:border-sun-green focus:ring-sun-green focus:outline-none transition">
            </div>

            <div>
                <label class="block font-bold text-gray-700 mb-1">¿En qué rancho trabajas? *</label>
                <select name="rancho" required class="w-full rounded-lg border-gray-300 shadow-sm p-3 border-2 bg-white focus:border-sun-green focus:ring-sun-green focus:outline-none">
                    <option value="">Selecciona una opción...</option>
                    <option value="Pocitos">Pocitos</option>
                    <option value="Majadas">Majadas</option>
                    <option value="San Guillermo">San Guillermo</option>
                    <option value="Barro 1">Barro 1</option>
                    <option value="Barro 2">Barro 2</option>
                    <option value="Barro 3">Barro 3</option>
                    <option value="Departamentos">Departamentos</option>
                </select>
            </div>

            <div>
                <label class="block font-bold text-gray-700 mb-1">¿Cuál es tu puesto? *</label>
                <select id="puesto" name="puesto" required class="w-full rounded-lg border-gray-300 shadow-sm p-3 border-2 bg-white focus:border-sun-green focus:ring-sun-green focus:outline-none" onchange="checkOtro('puesto')">
                    <option value="">Selecciona una opción...</option>
                    <option value="Encargado de campo">Encargado de campo</option>
                    <option value="Coordinador de campo">Coordinador de campo</option>
                    <option value="Lider de cuadrilla">Lider de cuadrilla</option>
                    <option value="Auxiliar de campo">Auxiliar de campo</option>
                    <option value="Lider de fumigacion">Lider de fumigacion</option>
                    <option value="Fumigador">Fumigador</option>
                    <option value="Lider de riego">Lider de riego</option>
                    <option value="Auxiliar de riego">Auxiliar de riego</option>
                    <option value="Vigilante">Vigilante</option>
                    <option value="Reclutador">Reclutador</option>
                    <option value="Limpieza">Limpieza</option>
                    <option value="Chofer de ruta">Chofer de ruta</option>
                    <option value="Chofer de campo">Chofer de campo</option>
                    <option value="Almacenista">Almacenista</option>
                    <option value="Cocinera">Cocinera</option>
                    <option value="Otros">Otros (Especificar)</option>
                </select>
                <input type="text" id="puesto_otro" class="mt-2 w-full p-2 border-2 border-gray-300 rounded-lg hidden focus:border-sun-green focus:outline-none" placeholder="Especifique su puesto">
            </div>

            <div class="bg-gray-50 p-4 rounded-lg border border-gray-100">
                <label class="block font-bold text-sun-green text-lg mb-3">¿Cuál fue el motivo de su ingreso? *</label>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3" id="motivo_ingreso_container">
                    <label class="flex items-center p-2 hover:bg-white rounded cursor-pointer transition"><input type="radio" name="motivo_ingreso" value="Necesidad" class="mr-3 h-4 w-4 text-sun-green focus:ring-sun-green"> Necesidad</label>
                    <label class="flex items-center p-2 hover:bg-white rounded cursor-pointer transition"><input type="radio" name="motivo_ingreso" value="Gusto al campo" class="mr-3 h-4 w-4 text-sun-green focus:ring-sun-green"> Gusto al campo</label>
                    <label class="flex items-center p-2 hover:bg-white rounded cursor-pointer transition"><input type="radio" name="motivo_ingreso" value="Recomendación" class="mr-3 h-4 w-4 text-sun-green focus:ring-sun-green"> Recomendación</label>
                    <label class="flex items-center p-2 hover:bg-white rounded cursor-pointer transition"><input type="radio" name="motivo_ingreso" value="Tiempo Libre" class="mr-3 h-4 w-4 text-sun-green focus:ring-sun-green"> Tiempo Libre</label>
                    <label class="flex items-center p-2 hover:bg-white rounded cursor-pointer transition"><input type="radio" name="motivo_ingreso" value="Cercania" class="mr-3 h-4 w-4 text-sun-green focus:ring-sun-green"> Cercanía</label>
                    <label class="flex items-center p-2 hover:bg-white rounded cursor-pointer transition"><input type="radio" name="motivo_ingreso" value="Prestaciones" class="mr-3 h-4 w-4 text-sun-green focus:ring-sun-green"> Prestaciones</label>
                    <label class="flex items-center p-2 hover:bg-white rounded cursor-pointer transition"><input type="radio" name="motivo_ingreso" value="Sueldos" class="mr-3 h-4 w-4 text-sun-green focus:ring-sun-green"> Sueldos</label>
                    <label class="flex items-center p-2 hover:bg-white rounded cursor-pointer transition"><input type="radio" name="motivo_ingreso" value="Ambiente Laboral" class="mr-3 h-4 w-4 text-sun-green focus:ring-sun-green"> Ambiente Laboral</label>
                    <div class="col-span-1 md:col-span-2">
                        <label class="flex items-center p-2 hover:bg-white rounded cursor-pointer transition"><input type="radio" name="motivo_ingreso" value="Otros" class="mr-3 h-4 w-4 text-sun-green focus:ring-sun-green"> Otros</label>
                        <input type="text" id="motivo_ingreso_otro" class="mt-2 ml-7 p-2 border rounded hidden w-3/4 focus:border-sun-green focus:outline-none" placeholder="Especifique">
                    </div>
                </div>
            </div>

            <div>
                <label class="block font-bold text-sun-green text-lg mb-2">Motivos de Salida *</label>
                <select id="motivo_salida" name="motivo_salida" required class="w-full rounded-lg border-gray-300 shadow-sm p-3 border-2 bg-white focus:border-sun-green focus:ring-sun-green focus:outline-none" onchange="checkOtro('motivo_salida')">
                     <option value="">Selecciona...</option>
                     <option value="Horario de trabajo">Horario de trabajo</option>
                     <option value="Sueldos">Sueldos</option>
                     <option value="Prestaciones de ley">Prestaciones de ley</option>
                     <option value="Bonos">Bonos</option>
                     <option value="Área asignada">Área asignada</option>
                     <option value="Coordinador / Líder">Coordinador / Líder</option>
                     <option value="Falta de oportunidades">Falta de oportunidades de crecimiento</option>
                     <option value="Reglas de la empresa">Reglas de la empresa</option>
                     <option value="Días de descanso">Días de descanso</option>
                     <option value="Motivos foráneos">Motivos foráneos</option>
                     <option value="Trato recibido">Trato recibido</option>
                     <option value="Escuela">Escuela</option>
                     <option value="Otros">Otros</option>
                </select>
                <input type="text" id="motivo_salida_otro" class="mt-2 w-full p-2 border-2 border-gray-300 rounded-lg hidden focus:border-sun-green focus:outline-none" placeholder="Especifique motivo">
            </div>

            <div class="bg-sun-light bg-opacity-40 p-6 rounded-xl border border-green-100">
                <h3 class="font-bold text-sun-green text-xl mb-6 border-b border-green-200 pb-2">Evaluación de la Experiencia</h3>
                <div class="space-y-8">
                     <label class="block font-bold text-gray-700">Recomendaciones para mejorar como empresa *</label>
                <div class="space-y-8">
                    <div class="pregunta-escala" data-name="apoyo_lider" data-label="¿Tuvo usted el apoyo de su lider para las actividades que desempeñó?"></div>
                    <div class="pregunta-escala" data-name="pago_acorde" data-label="¿Recibió el pago adecuado a las actividades que realizó?"></div>
                    <div class="pregunta-escala" data-name="instalaciones_adecuadas" data-label="¿Contaba con las instalaciones adecuadas para realizar su trabajo?"></div>
                    <div class="pregunta-escala" data-name="equipos_herramientas" data-label="¿Disponía usted de los equipos y herramientas adecuadas para realizar su trabajo?"></div>
                    <div class="pregunta-escala" data-name="capacitacion_induccion" data-label="¿Contó usted con la capacitación e inducción adecuada para realizar su trabajo?"></div>
                </div>
            </div>

            <div class="p-4 border border-gray-200 rounded-lg">
                <label class="block font-bold text-gray-700">¿Regresaría a trabajar con Agrícola Sun Berries? *</label>
                <div class="mt-3 space-x-6">
                    <label class="inline-flex items-center text-lg cursor-pointer"><input type="radio" name="regresaria_trabajar" value="Si" required class="mr-2 h-5 w-5 text-sun-green focus:ring-sun-green"> Sí</label>
                    <label class="inline-flex items-center text-lg cursor-pointer"><input type="radio" name="regresaria_trabajar" value="No" class="mr-2 h-5 w-5 text-red-600 focus:ring-red-600"> No</label>
                </div>
            </div>

            <div>
                <label class="block font-bold text-gray-700">Recomendaciones para mejorar como empresa *</label>
                <textarea name="recomendaciones" required rows="3" class="mt-2 w-full rounded-lg border-gray-300 shadow-sm p-3 border-2 focus:border-sun-green focus:ring-sun-green focus:outline-none"></textarea>
            </div>

            <button type="submit" id="submitBtn" class="w-full bg-sun-green text-white font-extrabold text-lg py-4 px-6 rounded-xl shadow-lg hover:bg-green-800 transform hover:-translate-y-1 transition duration-300">
                ENVIAR ENTREVISTA
            </button>
            <p id="mensaje" class="text-center text-sun-green font-bold text-xl hidden mt-6 p-4 bg-green-50 rounded-lg border border-green-200">
                ✅ ¡Gracias! Tu información ha sido guardada exitosamente.
            </p>

        </form>
    </div>

    <div class="text-center mt-8 text-gray-400 text-sm">
        <p>&copy; 2026 Agrícola Sun Berries - RH</p>
    </div>

    <script>
        // --- CONFIGURACIÓN ---
        // ¡PEGA AQUÍ TUS DATOS DE SUPABASE!
        const supabaseUrl = 'https://kqetrbmwznmlizibquus.supabase.co'
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtxZXRyYm13em5tbGl6aWJxdXVzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg4MzkxOTMsImV4cCI6MjA4NDQxNTE5M30.G06gOQmC5034XLEdGwfQeir6AgcnZa-GVWh2xxXtrhc'
        const clienteSupabase = supabase.createClient(supabaseUrl, supabaseKey)

        // --- LÓGICA ---
        const escalaOptions = ['SIEMPRE', 'CASI SIEMPRE', 'A VECES', 'CASI NUNCA', 'NUNCA'];
        document.querySelectorAll('.pregunta-escala').forEach(div => {
            const name = div.dataset.name;
            const label = div.dataset.label;
            let html = `<label class="block font-bold text-gray-700 mb-2">${label} *</label><div class="flex flex-wrap gap-3">`;
            escalaOptions.forEach(opt => {
                html += `<label class="inline-flex items-center text-sm px-3 py-1 bg-white border border-gray-300 rounded-full hover:bg-green-50 hover:border-sun-green cursor-pointer transition">
                            <input type="radio" name="${name}" value="${opt}" required class="mr-2 text-sun-green focus:ring-sun-green"> ${opt}
                         </label>`;
            });
            html += `</div>`;
            div.innerHTML = html;
        });

        function checkOtro(id) {
            const select = document.getElementById(id);
            const input = document.getElementById(id + '_otro');
            if (select.value.includes('Otros')) {
                input.classList.remove('hidden');
                input.required = true;
                input.focus();
            } else {
                input.classList.add('hidden');
                input.required = false;
            }
        }
        
        document.querySelectorAll('input[name="motivo_ingreso"]').forEach(radio => {
            radio.addEventListener('change', (e) => {
                const input = document.getElementById('motivo_ingreso_otro');
                if (e.target.value === 'Otros') {
                    input.classList.remove('hidden');
                    input.required = true;
                    input.focus();
                } else {
                    input.classList.add('hidden');
                    input.required = false;
                }
            });
        });

        document.getElementById('exitForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('submitBtn');
            const originalText = btn.innerText;
            btn.disabled = true;
            btn.innerText = "Enviando...";
            btn.classList.add('opacity-50', 'cursor-not-allowed');

            const formData = new FormData(e.target);
            const dataObj = Object.fromEntries(formData.entries());

            if (dataObj.puesto === 'Otros') dataObj.puesto = document.getElementById('puesto_otro').value;
            if (dataObj.motivo_ingreso === 'Otros') dataObj.motivo_ingreso = document.getElementById('motivo_ingreso_otro').value;
            if (dataObj.motivo_salida === 'Otros') dataObj.motivo_salida = document.getElementById('motivo_salida_otro').value;

            const { error } = await clienteSupabase.from('entrevistas_salida').insert([dataObj]);

            if (error) {
                alert('Error al guardar: ' + error.message);
                btn.disabled = false;
                btn.innerText = originalText;
                btn.classList.remove('opacity-50', 'cursor-not-allowed');
            } else {
                document.getElementById('exitForm').reset();
                document.getElementById('exitForm').classList.add('hidden');
                document.getElementById('mensaje').classList.remove('hidden');
                // Scroll suave al mensaje
                document.getElementById('mensaje').scrollIntoView({ behavior: 'smooth' });
            }
        });
    </script>
</body>
</html>


